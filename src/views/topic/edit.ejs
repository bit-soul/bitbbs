<%- include('../editor/sidebar') %>

<div id="content">
  <div class="panel">
    <div class="header">
      <ol class="breadcrumb">
        <li><a href="/">Home</a><span class="divider">/</span></li>
        <% if(typeof(action) !== 'undefined' && action == 'edit'){ %>
        <li class="active">Edit Topic</li>
        <% }else{ %>
        <li class="active">New Topic</li>
        <% } %>
      </ol>
    </div>

    <div class="inner post">
      <% if(typeof(edit_error) !== 'undefined' && edit_error){ %>
      <div class="alert alert-error">
        <a class="close" data-dismiss="alert" href="#">&times;</a>
        <strong><%= edit_error %></strong>
      </div>
      <% } %>

      <% if(typeof(error) !== 'undefined' && error){ %>
      <div class="alert alert-error">
        <strong><%= error %></strong>
      </div>
      <% } else { %>
        <% if (typeof(action) !== 'undefined' && action === 'edit') { %>
        <form id="create_topic_form" action="/topic/<%= topic_id %>/edit" method="post">
        <% } else { %>
        <form id="create_topic_form" action="/topic/create" method="post">
        <% } %>
          <fieldset>
            <span class="tab-selector">Select Category</span>
            <select name="tab" id="tab-value">
              <option value="">Select</option>
              <%
                var tabValue = "";
                if (typeof(tab) !== "undefined") {
                  tabValue = tab;
                }
                tabs.forEach(pair => {
                  var value = pair[0];
                  var text = pair[1];
              %>
              <option value="<%=value%>" <%= tabValue === value ? 'selected': '' %>><%= text %></option>
              <% }); %>
            </select>

            <span id="topic_create_warn"></span>

            <textarea autofocus class="span9" id="title" name="title" rows="1"
                      placeholder="Title must long than 10 character"
                    ><%= typeof(title) !== 'undefined' && title || '' %></textarea>

            <div class="markdown_editor in_editor">
              <div class="markdown_in_editor">
                <textarea class="editor" name="t_content" rows="20" 
                          placeholder="Markdown Supported"><%= typeof(content) !== 'undefined' && content || '' %></textarea>
                <div class="editor_buttons">
                  <input type="submit" class="span-primary submit_btn" data-loading-text="submitting" value="submit">
                </div>
              </div>
            </div>

            <input type="hidden" id="topic_tags" name="topic_tags" value="">
            <input type="hidden" name="_csrf" value="<%= csrf %>">
          </fieldset>
        </form>
      <% } %>
    </div>
  </div>
</div>

<!-- markdown editor -->
<%- include('../editor/editor') %>
<script>
document.addEventListener('DOMContentLoaded', function () {
  (function () {
    var editor = new Editor();
    editor.render($('.editor')[0]);

    $('#create_topic_form').on('submit', function (e) {
      var tabValue = $('#tab-value').val();
      if (!tabValue) {
        alert('Must select Category');
        $('.submit_btn').button('reset');
        $('.tab-selector').css('color', 'red');
        return false;
      }
    });

    $('#tab-value').on('change', function () {
      var $this = $(this);
      var value = $this.val();
      //var warnMsg = 'happy to use BitBBS';
      //$('#topic_create_warn').html(warnMsg);
    });
  })();
});
</script>
